<div class="modal-content border-0 invoice-modal">
    <div class="invoice-container p-4 bg-white" id="invoiceArea" *ngIf="bookingData; else loading">

        <!-- Header Section -->
        <div class="d-flex justify-content-between align-items-start mb-4">
            <div class="logo-box d-flex align-items-center justify-content-center font-weight-bold"
                style="width: 120px; height: 60px; border: 1px dashed #a0b4d4; background-color: #f2f6fa; color: #4a7fcb; font-size: 13px;">
                LOGO
            </div>
            <div class="text-right text-muted" style="font-size: 11px;">
                <h5 class="text-dark font-weight-bold mb-1">StayVelle Hotel</h5>
                <p class="mb-0">Bangalore, Karnataka, India - 560001</p>
                <p class="mb-0">+91 9999999999</p>
                <p class="mb-0 text-primary">info&#64;stayvelle.com</p>
                <p class="mb-0 text-primary">www.stayvelle.com</p>
                <p class="mb-0 mt-1 text-dark">GST No: 29ABCDE1234F1Z5</p>
            </div>
        </div>

        <hr style="border-top: 1px solid #333; margin: 5px 0 15px;">

        <h3 class="text-center font-weight-bold mb-3" style="color: #0b1c3c; letter-spacing: 3px; font-size: 20px;">
            INVOICE</h3>

        <!-- Billed To + Invoice Details -->
        <div class="row border-top border-bottom py-3 mb-4 mx-0"
            style="background-color: #fafbfc; border-color: #e5eaf2 !important;">
            <div class="col-6 border-right pr-3" style="border-color: #e5eaf2 !important;">
                <p class="mb-1 font-weight-600 text-uppercase" style="font-size: 10px; color: #a0b4d4;">BILLED TO:</p>
                <h6 class="font-weight-bold text-primary mb-1" style="font-size: 14px;">{{ primaryGuest?.guestName ||
                    'N/A' }}</h6>
                <p class="mb-0 text-muted" style="font-size: 11px;">{{ primaryGuest?.guestEmail || '' }}</p>
                <p class="mb-0 text-muted" style="font-size: 11px;">+{{ primaryGuest?.guestPhone || 'N/A' }}</p>
                <p class="mb-0 text-dark mt-1" style="font-size: 11px;">BK-{{ bookingData.bookingId }}</p>
            </div>
            <div class="col-6 pl-3" style="font-size: 11px;">
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Invoice No:</span>
                    <span class="text-dark font-weight-bold">{{ bookingData.bookingId }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Date:</span>
                    <span class="text-dark">{{ formatDateTime(bookingData.actualCheckInTime) }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Room:</span>
                    <span class="text-dark">{{ bookingData.room?.roomNumber || 'N/A' }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Room Type:</span>
                    <span class="text-danger font-weight-bold">{{ bookingData.room?.roomType || 'N/A' }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Check-In:</span>
                    <span class="text-dark">{{ formatDate(bookingData.checkInDate) }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Check-Out:</span>
                    <span class="text-dark">{{ formatDate(bookingData.checkOutDate) }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Nights:</span>
                    <span class="text-dark">{{ calculateNights() }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span style="color: #7b92b6;">Payment Mode:</span>
                    <span class="text-dark">{{ getPaymentMode() }}</span>
                </div>
            </div>
        </div>

        <!-- Items Table (no GST column) -->
        <table class="table table-borderless invoice-table mb-3">
            <thead style="background-color: #eef3ff; color: #333; font-size: 11px;">
                <tr>
                    <th class="py-2 pl-3 font-weight-bold" style="width: 40px;">Sl.</th>
                    <th class="py-2 font-weight-bold">Item</th>
                    <th class="py-2 font-weight-bold text-center" style="width: 60px;">Qty</th>
                    <th class="py-2 font-weight-bold text-right" style="width: 90px;">Rate</th>
                    <th class="py-2 pr-3 font-weight-bold text-right" style="width: 100px;">Amount</th>
                </tr>
            </thead>
            <tbody style="font-size: 11px; border-bottom: 1px solid #ccc;">
                <!-- Room Row: qty=1, rate = total room cost (price Ã— nights) -->
                <tr style="border-top: 1px solid #f0f0f0;">
                    <td class="py-2 pl-3">1</td>
                    <td class="py-2">
                        Room {{ bookingData.room?.roomNumber || 'N/A' }}
                        <span class="text-muted" style="font-size: 10px;">
                            ({{ bookingData.room?.roomType }}, {{ bookingData.room?.acType }}, {{ calculateNights() }}
                            night{{ calculateNights() > 1 ? 's' : '' }} &#64; &#8377;{{ bookingData.room?.price
                            }}/night)
                        </span>
                    </td>
                    <td class="py-2 text-center">1</td>
                    <td class="py-2 text-right">{{ getRoomBasePrice() | number:'1.2-2' }}</td>
                    <td class="py-2 pr-3 text-right font-weight-bold">{{ getRoomBasePrice() | number:'1.2-2' }}</td>
                </tr>
                <!-- Merged Service Rows -->
                <tr *ngFor="let service of mergedServices; let i = index" style="border-top: 1px solid #f0f0f0;">
                    <td class="py-2 pl-3">{{ i + 2 }}</td>
                    <td class="py-2">
                        {{ service.serviceName }}
                        <span class="text-muted" style="font-size: 10px;">({{ service.serviceCategory }})</span>
                    </td>
                    <td class="py-2 text-center font-weight-bold">{{ service.quantity }}</td>
                    <td class="py-2 text-right">{{ service.price | number:'1.2-2' }}</td>
                    <td class="py-2 pr-3 text-right font-weight-bold">{{ getServiceAmount(service) | number:'1.2-2' }}
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Totals -->
        <div class="row mb-3">
            <div class="col-5"></div>
            <div class="col-7 text-right pr-3" style="font-size: 11px;">
                <div class="d-flex justify-content-between mb-2">
                    <span style="color: #7b92b6;">Sub Total (Rs.) :</span>
                    <span class="font-weight-bold text-dark" style="width: 90px; text-align: right;">{{
                        calculateSubTotal() | number:'1.2-2' }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span style="color: #7b92b6;">Tax (18%) :</span>
                    <span class="font-weight-bold text-dark" style="width: 90px; text-align: right;">{{ calculateTax() |
                        number:'1.2-2' }}</span>
                </div>
                <div class="d-flex justify-content-between border-top pt-2 pb-2 mb-2">
                    <span class="font-weight-bold" style="color: #333; font-size: 12px;">Total (Rs.) :</span>
                    <span class="font-weight-bold text-dark" style="font-size: 13px; width: 90px; text-align: right;">{{
                        calculateTotal() | number:'1.2-2' }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span style="color: #7b92b6;">Paid (Rs.) :</span>
                    <span class="font-weight-bold text-success" style="width: 90px; text-align: right;">{{
                        calculatePaidAmount() | number:'1.2-2' }}</span>
                </div>
                <div class="d-flex justify-content-between border-top border-bottom py-2 mt-1">
                    <span class="font-weight-bold" style="color: #7b92b6; font-size: 12px; margin-top: 2px;">Balance
                        (Rs.) :</span>
                    <span class="font-weight-bold" [class.text-success]="isPaid" [class.text-danger]="!isPaid"
                        style="font-size: 14px; width: 90px; text-align: right;">{{ calculateBalance() | number:'1.2-2'
                        }}</span>
                </div>
            </div>
        </div>

        <!-- PAID Stamp -->
        <div *ngIf="isPaid" class="d-flex justify-content-end pr-3 mb-2">
            <div style="border: 3px solid #28a745; border-radius: 4px; padding: 4px 18px; display: inline-block;">
                <span
                    style="color: #28a745; font-size: 22px; font-weight: 900; letter-spacing: 4px; opacity: 0.85;">PAID</span>
            </div>
        </div>

        <!-- Footer -->
        <div class="d-flex justify-content-between align-items-end mt-3 mb-2">
            <div style="font-size: 11px;" class="pl-2">
                <p class="font-italic text-dark mb-1">Thank you for staying with us!</p>
                <p class="font-italic text-primary mb-0">{{ numberToWords(calculateTotal()) }}</p>
            </div>
            <div class="pr-2 text-right">
                <div style="height: 40px;"></div>
                <div style="border-top: 1px dashed #000; padding-top: 5px; margin-top: 30px;">
                    <span class="font-weight-bold text-dark" style="font-size: 12px;">Authorised Signatory</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <ng-template #loading>
        <div class="p-5 text-center text-muted">
            <div class="spinner-border text-primary mb-3" role="status"></div>
            <p style="font-size: 14px;">Loading bill details...</p>
        </div>
    </ng-template>

    <!-- Modal Buttons -->
    <div class="modal-footer bg-light border-top d-print-none d-flex justify-content-center gap-3">
        <button type="button" class="btn btn-outline-secondary px-4" (click)="cancel()">Cancel</button>
        <button type="button" class="btn btn-primary px-4 d-flex align-items-center gap-2" (click)="print()">
            <span class="material-icons" style="font-size: 18px;">download</span> Download Bill
        </button>
    </div>
</div>