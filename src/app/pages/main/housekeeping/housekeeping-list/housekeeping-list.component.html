<div class="add_services_container">
  <h3 class="font_20 fw_semi text_black mb_2">Housekeeping</h3>
  <span class="text_pri fw_med font_12 d-block mb_13">Housekeeping Management <span class="text_black">~ {{ showEditForm ? (isEditMode ? 'Update Task' : 'Add Task') : 'Housekeeping' }}</span></span>
  
  <!-- Edit/Add Form -->
  <div *ngIf="showEditForm" class="services_info_blk add_services_info_blk mb_24">
    <form [formGroup]="housekeepingForm" (ngSubmit)="onSubmit()">
      <div class="row">
        <div class="col-md-6">
          <div class="d-flex flex-column">
            <label class="font_14 fw_med text_black mb_7">Room ID <span class="text-danger">*</span></label>
            <input
              type="number"
              formControlName="roomId"
              class="form-control"
              placeholder="Enter room ID"
            />
            <div *ngIf="housekeepingForm.get('roomId')?.invalid && housekeepingForm.get('roomId')?.touched" class="error-message font_12 text-danger mt_5">
              Room ID is required
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="d-flex flex-column">
            <label class="font_14 fw_med text_black mb_7">Booking ID</label>
            <input
              type="number"
              formControlName="bookingId"
              class="form-control"
              placeholder="Enter booking ID"
            />
          </div>
        </div>

        <div class="col-md-6">
          <div class="d-flex flex-column">
            <label class="font_14 fw_med text_black mb_7">Task Type <span class="text-danger">*</span></label>
            <select formControlName="taskType" class="custom-select">
              <option value="">Select Task Type</option>
              <option value="Cleaning">Cleaning</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Inspection">Inspection</option>
              <option value="Setup">Setup</option>
            </select>
            <div *ngIf="housekeepingForm.get('taskType')?.invalid && housekeepingForm.get('taskType')?.touched" class="error-message font_12 text-danger mt_5">
              Task type is required
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="d-flex flex-column">
            <label class="font_14 fw_med text_black mb_7">Task Status <span class="text-danger">*</span></label>
            <select formControlName="taskStatus" class="custom-select">
              <option value="">Select Status</option>
              <option value="Pending">Pending</option>
              <option value="In Progress">In Progress</option>
              <option value="Completed">Completed</option>
            </select>
            <div *ngIf="housekeepingForm.get('taskStatus')?.invalid && housekeepingForm.get('taskStatus')?.touched" class="error-message font_12 text-danger mt_5">
              Task status is required
            </div>
          </div>
        </div>

        <div class="col-md-12">
          <label class="font_14 fw_semi text_black mb_7">Room Images <span class="font_12 text-muted">(Optional - Multiple images allowed)</span></label>
          
          <!-- Display existing and new images -->
          <div *ngIf="getAllImages().length > 0" class="mb_15">
            <div class="d-flex flex-wrap gap-3">
              <!-- Existing Images -->
              <div *ngFor="let image of existingImages; let i = index" class="position-relative" style="width: 150px; height: 150px;">
                <img [src]="image" alt="Room Image" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 2px solid #ddd;">
                <button 
                  type="button" 
                  class="btn btn-sm btn-danger position-absolute" 
                  style="top: 5px; right: 5px; border-radius: 50%; width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center; z-index: 10;"
                  (click)="removeExistingImage(i)"
                  title="Remove Image"
                >
                  ×
                </button>
              </div>
              
              <!-- New Images (previews) -->
              <div *ngFor="let image of imagePreviews; let i = index" class="position-relative" style="width: 150px; height: 150px;">
                <img [src]="image" alt="New Image Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 2px solid #28a745;">
                <button 
                  type="button" 
                  class="btn btn-sm btn-danger position-absolute" 
                  style="top: 5px; right: 5px; border-radius: 50%; width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center; z-index: 10;"
                  (click)="removeNewImage(i)"
                  title="Remove Image"
                >
                  ×
                </button>
              </div>
            </div>
          </div>
          
          <!-- Upload Area -->
          <div class="dragBox d-flex align-items-center flex-column">
            <img src="assets/images/file_upload_img.svg" class="mb_7" alt="Upload">
            <div class="font_16 fw_med text_black">
              <span *ngIf="getAllImages().length === 0">Add Room Images</span>
              <span *ngIf="getAllImages().length > 0">Add More Images</span>
              <span class="font_12">(jpg, jpeg, png, svg - max 5MB each)</span>
            </div>
            <input 
              type="file" 
              (change)="onFileSelected($event)" 
              accept="image/jpeg,image/jpg,image/png,image/svg+xml" 
              multiple
            />
            <div class="font_12 text-muted mt_5">You can select multiple images at once</div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="d-flex flex-column">
            <label class="font_14 fw_med text_black mb_7">Assigned To User ID</label>
            <input
              type="number"
              formControlName="assignedToUserId"
              class="form-control"
              placeholder="Enter user ID"
            />
          </div>
        </div>
      </div>
    </form>
  </div>
  
  <!-- Footer Buttons -->
  <div class="right_side_footer_blk d-flex align-items-center justify-content-center" *ngIf="showEditForm">
    <button type="button" class="btn_primary btn_secondary mr_20 w-200px" (click)="cancelEdit()" [disabled]="isLoading">Cancel</button>
    <button type="button" class="btn_primary mr_20 w-200px" (click)="onSubmit()" [disabled]="isLoading || housekeepingForm.invalid">
      <span *ngIf="!isLoading">{{ isEditMode ? 'Update' : 'Create' }}</span>
      <span *ngIf="isLoading">{{ isEditMode ? 'Updating...' : 'Creating...' }}</span>
    </button>
  </div>

  <!-- List View -->
  <div *ngIf="!showEditForm">
    <!-- Search and Filter Section -->
  <div class="services_info_blk position-relative mb_24">
    <div class="row">
      <div class="col-md-3">
        <div class="d-flex flex-column">
          <label class="font_14 fw_med text_black mb_5">Start Date</label>
          <input 
            type="date" 
            class="form-control" 
            [(ngModel)]="filterStartDate"
          >
        </div>
      </div>
      <div class="col-md-3">
        <div class="d-flex flex-column">
          <label class="font_14 fw_med text_black mb_5">End Date</label>
          <input 
            type="date" 
            class="form-control" 
            [(ngModel)]="filterEndDate"
          >
        </div>
      </div>
      <div class="col-md-3">
        <div class="d-flex flex-column">
          <label class="font_14 fw_med text_black mb_5">Status</label>
          <select class="custom-select" [(ngModel)]="filterStatus">
            <option value="">Select</option>
            <option>Pending</option>
            <option>In Progress</option>
            <option>Completed</option>
          </select>
        </div>
      </div>
      <div class="col-md-3">
        <div class="d-flex flex-column">
          <label class="font_14 fw_med text_black mb_5">Room Number</label>
          <input 
            type="text" 
            class="form-control" 
            placeholder="Search by room number"
            [(ngModel)]="filterRoom"
          >
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-center">
      <button class="btn_primary search_pos" (click)="onSearch()">Search</button>
    </div>
  </div>

  <!-- Filter Tags and Add Housekeeping Button -->
  <div class="d-flex align-items-center justify-content-between mb_24">
    <div class="d-flex align-items-center">
      <div 
        class="d-flex align-items-center mr_20" 
        *ngFor="let filter of activeFilters"
      >
        <div class="luxury_info_blk d-flex align-items-center">
          <span class="font_10 fw_reg text_black luxury_txt d-block">{{ filter.label }}</span>
          <img 
            src="assets/images/cross_svgrepo.com.svg" 
            alt="" 
            class="cursor-pointer pl_8"
            (click)="removeFilter(filter.type)"
          >
        </div>
      </div>
    </div>
    <button class="text-decoration-none btn_primary services_pd" (click)="showAddForm()">Add Housekeeping</button>
  </div>

  <!-- Housekeeping Table -->
  <div class="mb_21 rounded table-responsive">
    <table class="">
      <thead>
        <tr>
          <th>Task ID</th>
          <th>Room Number</th>
          <th>Room Type</th>
          <th>Task Type</th>
          <th>Task Status</th>
          <th>Booking ID</th>
          <th>Created On</th>
          <th>Assigned To</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of filteredHousekeeping">
          <td>{{ item.taskId || 'N/A' }}</td>
          <td>{{ item.room?.roomNumber || 'N/A' }}</td>
          <td>{{ item.room?.roomType || 'N/A' }}</td>
          <td>{{ item.taskType || 'N/A' }}</td>
          <td>
            <span [class]="'status-badge ' + getStatusClass(item.taskStatus)">
              {{ item.taskStatus || 'N/A' }}
            </span>
          </td>
          <td>{{ item.bookingId || '-' }}</td>
          <td>{{ formatDate(item.createdOn) }}</td>
          <td>{{ item.assignedToUserId || '-' }}</td>
          <td>
            <div class="d-flex align-items-center">
              <img 
                src="assets/images/edit_icon.svg" 
                alt="Edit" 
                class="cursor-pointer mr_10"
                (click)="editHousekeeping(item)"
              >
              <img 
                src="assets/images/delete_icon.svg" 
                alt="Delete" 
                class="cursor-pointer"
                (click)="deleteHousekeeping(item)"
              >
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredHousekeeping.length === 0">
          <td colspan="9" class="text-center">No housekeeping records found</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="d-flex align-items-center justify-content-between">
    <span class="d-block font_12 fw_reg text_black">Showing {{ filteredHousekeeping.length }} of {{ allHousekeeping.length }} Results</span>
    <div class="pagination_blk d-flex align-items-center">
      <img src="assets/images/left_arrow.svg" alt="" class="cursor-pointer mr_12">
      <span class="active font_12 fw_med cursor-pointer">1</span>
      <span class="font_12 fw_med cursor-pointer">2</span>
      <span class="font_12 fw_med cursor-pointer">3</span>
      <img src="assets/images/chevron-down.svg" alt="" class="ml_12 cursor-pointer">
    </div>
  </div>
  </div>
</div>

